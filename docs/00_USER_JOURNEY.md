# ユーザージャーニーとユースケース

## 前提の整理

### このツールは何のためにあるのか？

**WEBアプリのテストにおいて、「何をテストしていないか」を人間が気づけるようにする**

従来のテスト管理ツールは「人間が考えたテストケースを管理する」だけ。
このツールは **「AIが自動的にテスト観点を発見し、人間が漏れに気づく」** ことを目指す。

---

## 役割分担：人間 vs AI

### 👤 人間がやること

| # | やること | タイミング | 場所 |
|---|---------|----------|------|
| 1 | プロジェクトを指定する | 初回のみ | VSCode/Terminal |
| 2 | AIに「スキャンして」と指示 | 初回 + 定期的 | VSCode/Terminal |
| 3 | GUIで進捗を確認する | いつでも | ブラウザ |
| 4 | 「あ、ここが漏れてる」と気づく | GUI確認時 | ブラウザ |
| 5 | AIに「この観点を追加して」と指示 | 気づいた時 | VSCode/Terminal |
| 6 | AIに「このテストを実行して」と指示 | 必要に応じて | VSCode/Terminal |

**人間は基本的に「見る」だけ。操作はAIに指示する。**

### 🤖 AIがやること

| # | やること | トリガー | 結果 |
|---|---------|---------|------|
| 1 | プロジェクトのソースコードを解析 | 人間の指示 | サーフェス検出 |
| 2 | 各サーフェスのテスト観点を生成 | 人間の指示 | testing-brain/*.json 作成 |
| 3 | 既存の観点を深掘り（再帰的発見） | 人間の指示 | 子観点を追加 |
| 4 | テストを実行してステータス更新 | 人間の指示 | status を passed に |
| 5 | 操作ログを記録 | 常時 | ai-log.jsonl に追記 |

**AIは「ファイルを読み書きする」ことで状態を更新する。**

---

## ユーザージャーニー（典型的な1日の流れ）

### シナリオ1: 初回セットアップ

```
[朝9:00] プロジェクトにこのツールを導入したい
  ↓
1. testing-brain/ をプロジェクトルートに配置
  ↓
2. VSCodeでClaude Codeを起動
  ↓
3. 「.agent/skills/testing-brain-management/SKILL.mdを読んで、
    このプロジェクトの初期スキャンを実行してください」と指示
  ↓
4. AIが5分ほどでスキャン完了
   → testing-brain/surfaces/ に20個のファイルが生成される
  ↓
5. ブラウザで http://localhost:5173 を開く
  ↓
6. ダッシュボードを見る
   → 「網羅率 5%」「サーフェス数 20」「未テスト 180観点」
  ↓
7. 「あ、こんなに観点があるのか...」と気づく
```

### シナリオ2: 日常的な確認

```
[午後2:00] 今日のテスト進捗を確認したい
  ↓
1. ブラウザで http://localhost:5173 を開く
  ↓
2. ダッシュボードを見る
   → 「網羅率 35%」
   → Fog of Warグリッドで「ログイン画面」が暗い（網羅率10%）
  ↓
3. 「ログイン画面」タイルをクリック
  ↓
4. 詳細画面で観点リストを見る
   → 「パスワードリセット機能のテストが未テスト」と気づく
  ↓
5. VSCodeに戻り、Claude Codeに指示
   「login-page.json に『パスワードリセット機能』の観点を追加して」
  ↓
6. AIが観点を追加
   → testing-brain/surfaces/login-page.json が更新される
  ↓
7. ブラウザが3秒以内に自動更新される
   → 新しい観点が表示される
```

### シナリオ3: テスト実行と進捗更新

```
[午後4:00] テストを実行して進捗を記録したい
  ↓
1. VSCodeでClaude Codeに指示
   「login-page.json の VP-003（ネットワークエラー時）をテストして」
  ↓
2. AIがテストコードを書いて実行
  ↓
3. テストが成功
  ↓
4. AIが testing-brain/surfaces/login-page.json を更新
   → VP-003 の status を "passed" に変更
   → evidence に "E2E test login.spec.ts#L50" を記録
  ↓
5. AIが testing-brain/progress.json を再計算
   → overall.passed が +1 される
  ↓
6. AIが testing-brain/ai-log.jsonl にログを追記
  ↓
7. ブラウザが3秒以内に自動更新される
   → 網羅率が 35% → 36% に上がる
   → Fog of Warグリッドの「ログイン画面」が少し明るくなる
```

---

## ユースケース一覧

### UC-01: プロジェクトの初期スキャン
- **アクター**: 人間 + AI
- **前提**: プロジェクトにソースコードがある
- **トリガー**: 人間が「スキャンして」と指示
- **結果**: testing-brain/surfaces/ に全サーフェスファイルが生成される

### UC-02: 網羅率の確認
- **アクター**: 人間
- **前提**: testing-brain/ にデータがある
- **トリガー**: ブラウザでダッシュボードを開く
- **結果**: 現在の網羅率とサーフェス一覧が表示される

### UC-03: 漏れの発見
- **アクター**: 人間
- **前提**: ダッシュボードを見ている
- **トリガー**: Fog of Warグリッドで暗いタイルに気づく
- **結果**: 「このサーフェスのテストが足りない」と認識する

### UC-04: 観点の追加
- **アクター**: 人間 + AI
- **前提**: 漏れに気づいた
- **トリガー**: AIに「この観点を追加して」と指示
- **結果**: testing-brain/surfaces/*.json に新しい観点が追加される

### UC-05: テスト実行と進捗更新
- **アクター**: 人間 + AI
- **前提**: 未テストの観点がある
- **トリガー**: AIに「このテストを実行して」と指示
- **結果**: テストが実行され、ステータスが "passed" に更新される

### UC-06: 再帰的発見
- **アクター**: 人間 + AI
- **前提**: 既存の観点がある
- **トリガー**: AIに「この観点を深掘りして」と指示
- **結果**: 既存観点の children に子観点が追加される

### UC-07: 進捗の自動反映
- **アクター**: システム
- **前提**: ブラウザでダッシュボードを開いている
- **トリガー**: testing-brain/*.json が更新される
- **結果**: 3秒以内にGUIが自動更新される

---

## データフロー図

```
┌─────────────────────────────────────────────────────────┐
│                    Human (You)                           │
│                                                          │
│  ┌──────────────┐              ┌──────────────────────┐ │
│  │  Browser      │              │  VSCode / Terminal    │ │
│  │  (GUI閲覧)    │              │  (AI操作)             │ │
│  │               │              │                       │ │
│  │  1. 見る      │              │  2. 指示を出す        │ │
│  │  2. 気づく    │              │  「スキャンして」     │ │
│  │               │              │  「観点を追加して」   │ │
│  └──────┬───────┘              └──────────┬───────────┘ │
│         │ HTTP (read-only)                │ 自然言語     │
└─────────┼─────────────────────────────────┼─────────────┘
          │                                 │
          ▼                                 ▼
┌──────────────────────────────────────────────────────────┐
│              Project Root                                 │
│                                                           │
│  ┌─────────────────────┐  ┌────────────────────────────┐ │
│  │  testing-brain/      │  │  AI Agent (Claude Code)     │ │
│  │  (データ層)          │◄─┤                             │ │
│  │                      │  │  3. ファイルを読む          │ │
│  │  ├── config.json     │  │  4. 解析する                │ │
│  │  ├── surfaces/       │  │  5. ファイルを書く          │ │
│  │  ├── progress.json   │  │  6. ログを追記する          │ │
│  │  └── ai-log.jsonl    │  │                             │ │
│  └─────────────────────┘  └────────────────────────────┘ │
│          ▲                                                │
│          │ 3秒ポーリング                                  │
│          │                                                │
│  ┌───────┴──────────────────────────────────────────────┐ │
│  │  GUI (Vite + React)                                   │ │
│  │                                                        │ │
│  │  7. JSONを読み取る                                     │ │
│  │  8. ダッシュボードを更新する                           │ │
│  └────────────────────────────────────────────────────────┘ │
└──────────────────────────────────────────────────────────┘
```

---

## 重要な設計思想の再確認

### 1. GUIは「読み取り専用」

GUIからデータを編集することは **できない**。
すべての編集はAIが行う。

### 2. AIは「ファイルを読み書きする」

AIはデータベースやAPIを使わず、**JSONファイルの読み書きだけ**で状態を管理する。

### 3. 人間は「見て気づく」

人間は細かい操作をせず、**ダッシュボードを見て「漏れ」に気づくだけ**。

### 4. Fog of Warは「違和感」を生む

網羅率が低いサーフェスは暗く・ぼやけて表示され、
人間に「なんか気になる」という **直感的な違和感** を与える。

---

## 次に確認したいこと

1. **この理解で合っていますか？**
2. **人間とAIの役割分担は想定通りですか？**
3. **ユーザージャーニーで足りないシナリオはありますか？**
4. **GUIに必要な機能で抜けているものはありますか？**
