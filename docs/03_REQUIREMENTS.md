# 03. 要件定義 — 究極の網羅性管理に必要な全要件

## 要件の分類体系

要件は以下の6つのカテゴリに分類される。
それぞれが「網羅性」を異なる角度から保証する。

---

## カテゴリ A: サーフェス発見（Surface Discovery）

テスト対象となる「面（Surface）」を漏れなく特定する。

| ID | 要件 | 説明 | 優先度 |
|----|------|------|--------|
| A-001 | 画面自動列挙 | ルーティング定義からすべての画面を自動検出する | 🔴 Must |
| A-002 | コンポーネント列挙 | UIコンポーネントツリーを解析し、再利用されるコンポーネントを特定する | 🔴 Must |
| A-003 | 隠れUI検出 | モーダル、ツールチップ、ドロップダウン、トースト等の条件付き表示要素を検出する | 🟡 Should |
| A-004 | APIエンドポイント列挙 | バックエンドのルート定義からすべてのエンドポイントを特定する | 🔴 Must |
| A-005 | フォーム入力フィールド列挙 | 各画面のフォーム要素（input, select, textarea等）と制約（required, maxlength等）を特定する | 🔴 Must |
| A-006 | ナビゲーションパス列挙 | 画面間の遷移パスをグラフとして構築する | 🟡 Should |
| A-007 | 外部依存検出 | 外部API、SDK、サードパーティサービスへの依存を特定する | 🟢 Nice |

---

## カテゴリ B: 観点生成（Viewpoint Generation）

各サーフェスに対して「何をテストすべきか」の観点を自動生成する。

| ID | 要件 | 説明 | 優先度 |
|----|------|------|--------|
| B-001 | 正常系テスト観点 | 各機能の「期待通りの動作」に対する観点 | 🔴 Must |
| B-002 | 異常系テスト観点 | バリデーションエラー、404、500、タイムアウト等の異常ケース | 🔴 Must |
| B-003 | 境界値テスト観点 | 入力フィールドの最小値・最大値・境界値 | 🔴 Must |
| B-004 | 状態遷移テスト観点 | 「A操作の後にB操作」等の状態依存テスト | 🟡 Should |
| B-005 | 権限・状態別テスト観点 | ログイン/未ログイン、データあり/なし等の条件分岐 | 🟡 Should |
| B-006 | 競合状態テスト観点 | 連打、二重送信、同時操作による不整合 | 🟡 Should |
| B-007 | データ量テスト観点 | 0件、1件、大量データでの挙動 | 🟡 Should |
| B-008 | 表示崩れテスト観点 | 長文テキスト、特殊文字、多言語での表示確認 | 🟢 Nice |
| B-009 | アクセシビリティ観点 | キーボード操作、スクリーンリーダー対応、コントラスト比 | 🟢 Nice |
| B-010 | パフォーマンス観点 | 初期表示速度、大量データ時のスクロール性能 | 🟢 Nice |

---

## カテゴリ C: 進捗管理（Progress Tracking）

テストの消化状況と全体の網羅率を管理する。

| ID | 要件 | 説明 | 優先度 |
|----|------|------|--------|
| C-001 | ステータス4値管理 | 各観点のステータスを `untested` / `in_progress` / `passed` / `omission` の4値で管理 | 🔴 Must |
| C-002 | 階層別進捗 | サーフェス単位・カテゴリ単位・全体の3階層で進捗率を算出 | 🔴 Must |
| C-003 | タイムスタンプ記録 | 各ステータス変更の日時を記録する | 🟡 Should |
| C-004 | 変更履歴 | どのAIエージェントが、いつ、何を変更したかのログ | 🟡 Should |
| C-005 | 進捗サマリ自動算出 | progress.json を surfaces/*.json の集計結果から自動生成 | 🔴 Must |
| C-006 | 停滞検知 | 一定期間更新されていないサーフェスを「停滞」として警告 | 🟢 Nice |

---

## カテゴリ D: GUI可視化（Visual Dashboard）

人間が「漏れ」に直感的に気づけるUIを提供する。

| ID | 要件 | 説明 | 優先度 |
|----|------|------|--------|
| D-001 | ダッシュボード | 全体の網羅率、サーフェス数、漏れ数を一目で把握できるトップ画面 | 🔴 Must |
| D-002 | Fog of War表示 | 未テスト領域を「霧」で覆い、テスト済み領域を「クリア」に表示 | 🔴 Must |
| D-003 | サーフェス詳細画面 | 個別サーフェスの全観点リストと消化状況を表示 | 🔴 Must |
| D-004 | フィルタリング | ステータス、カテゴリ、サーフェス単位でのフィルタリング | 🟡 Should |
| D-005 | ソート | 網羅率昇順（=漏れが多い順）でのソート | 🟡 Should |
| D-006 | AI操作ログ表示 | AIの操作ログをリアルタイムでフィード表示 | 🟡 Should |
| D-007 | 自動リフレッシュ | JSONファイル変更時に画面を自動更新（ポーリング3秒） | 🔴 Must |
| D-008 | レスポンシブ対応 | PC/タブレットで使用可能なレイアウト | 🟢 Nice |
| D-009 | ダークモード | デフォルトでダークテーマ、目に優しいデザイン | 🔴 Must |
| D-010 | アニメーション | ステータス変更時のスムースな遷移アニメーション | 🟡 Should |
| D-011 | 網羅率ヒートマップ | サーフェスをタイル状に並べ、色の濃淡で網羅率を表現 | 🟡 Should |
| D-012 | 漏れ検出アラート | omission ステータスの項目を目立つ形で警告表示 | 🔴 Must |

---

## カテゴリ E: AIプロトコル（AI Integration Protocol）

AIエージェントが効率的にファイルを読み書きするための仕様。

| ID | 要件 | 説明 | 優先度 |
|----|------|------|--------|
| E-001 | JSONスキーマ定義 | すべてのJSONファイルのスキーマを明確に定義する | 🔴 Must |
| E-002 | テンプレート提供 | AIが新しいサーフェスを追加する際の雛形JSONを提供する | 🔴 Must |
| E-003 | 操作マニュアル | AIが「何をどの順でやるべきか」を記述したプロトコルドキュメント | 🔴 Must |
| E-004 | バリデーション | AIが書き込んだJSONがスキーマに準拠しているか検証する仕組み | 🟡 Should |
| E-005 | 冪等性 | 同じ操作を何度実行しても同じ結果になること（AIの再実行安全性） | 🟡 Should |
| E-006 | 部分更新 | 1ファイルの一部だけを更新可能な構造（巨大なJSONの全書き換え回避） | 🟡 Should |

---

## カテゴリ F: 拡張性（Extensibility）

将来的な拡張に備えた設計。

| ID | 要件 | 説明 | 優先度 |
|----|------|------|--------|
| F-001 | カスタムテンプレート | ユーザーが独自の観点テンプレートを追加できる | 🟢 Nice |
| F-002 | マルチプロジェクト対応 | 複数のプロジェクトをタブ切り替えで管理 | 🟢 Nice |
| F-003 | CI/CD連携 | テスト自動実行結果をJSONに自動反映 | 🟢 Nice |
| F-004 | エクスポート | 進捗レポートをMarkdownやPDFで出力 | 🟢 Nice |
| F-005 | プラグインシステム | 観点生成ロジックをプラグインとして差し替え可能 | 🟢 Nice |

---

## 要件サマリ

| カテゴリ | Must | Should | Nice | 合計 |
|---------|------|--------|------|------|
| A: サーフェス発見 | 3 | 2 | 2 | 7 |
| B: 観点生成 | 3 | 4 | 3 | 10 |
| C: 進捗管理 | 3 | 2 | 1 | 6 |
| D: GUI可視化 | 5 | 4 | 3 | 12 |
| E: AIプロトコル | 3 | 3 | 0 | 6 |
| F: 拡張性 | 0 | 0 | 5 | 5 |
| **合計** | **17** | **15** | **14** | **46** |
